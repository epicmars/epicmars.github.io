<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta lang="zh"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>
            
    JavaScript: 变量、作用域与内存 &ndash; DevNote

        </title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
        
    <link rel="stylesheet" type="text/css" media="screen" href="/css/article.css" />

    </head>

    <body>
        <header>
    <a href="https://www.jastrelax.com/">DevNote</a>
</header>
        
    <div class="main">
        <div class="article">
            <article>
                <div class="title">
                    <h1 id="title">JavaScript: 变量、作用域与内存</h1>
                </div>
                <div class="content">
                        

<h2 id="基本类型和引用类型的值">基本类型和引用类型的值</h2>

<h3 id="动态的属性">动态的属性</h3>

<p>ECMAScript变量可能包含两种不同数据类型的值：基本类型值和引用类型值。
给基本类型添加属性尽管不会导致错误，但是无效的行为。</p>

<h3 id="复制变量值">复制变量值</h3>

<p>对于基本类型赋值，会在变量对象上创建一个新值，然后把新值复制到为新变量分配的位置。</p>

<p>对于引用类型赋值，同样会将存储在变量对象中的值复制一份到为新变量分配的空间中，不同的是，这个值的复本实际上是一个指针，它们都指向同一个对象。</p>

<h3 id="传递参数">传递参数</h3>

<p>在参数传递中，传递基本类型值时，被传递的值会被复制给一个局部变量（即，命名参数或ECMAScript中arguments对象中的一个元素）。传递引用类型的值，会把这个值在内存中的地址复制给一个局部变量。</p>

<h3 id="检测类型">检测类型</h3>

<p>对于基本类型的检测，使用<code>typeof</code>操作符是最佳工具。</p>

<p>对于引用类型，<code>typeof</code>都会返回&rdquo;object&rdquo;，无法区分不同类型对象，因此常用<code>instanceof</code>操作符来判断一个对象是否是某一类型的实例。</p>

<h2 id="执行环境及作用域">执行环境及作用域</h2>

<p><strong>执行环境（execution context）</strong>是JavaScript中最重要的一个概念。执行环境定义了变量或函数有权访问的其它数据，决定了它们各自的行为。每个执行环境都有一个与之关联的变量对象(variable object)，环境中定义的所有变量和函数都保存在这个对象中。虽然我们编写的代码无法访问这个对象，但解析器在处理数据时会在后台使用它。</p>

<p>全局执行环境是最外围的一个执行环境。根据ECMAScript实现所在的宿主环境不同，表示执行环境的对象也不一样。在Web浏览器中，全局执行环境被认为是window对象，因此所有全局变量和函数都是作为window对象的属性和方法创建的。</p>

<p>每个函数都有自己的执行环境。当执行流进入一个函数时，函数的环境就会被推入一个环境栈中。而在函数执行后，栈将其环境弹出，把控制权返回给之前的执行环境。</p>

<p>当代码在一个环境中执行时，会创建变量对象的一个<strong>作用域链（scope chain）</strong>。作用域链的用途是保证对执行环境有权访问的所有变量和函数的有序访问。</p>

<p>内部环境可以通过作用域链访问所有的外部环境，但外部环境不能访问内部环境中的任何变量和函数。这些环境之间的联系是线性、有次序的。每个环境都可以向上搜索作用域链，以查询变量和函数名；但任何环境都不能通过向下搜索作用域链而进入另一个执行环境。</p>

<p>JavaScript没有块级作用域经常会导致理解上的困惑。</p>

<h3 id="延长作用域链">延长作用域链</h3>

<p>执行环境类型总共有两种——全局和局部（函数），但有其它办法来延长作用域链。有些语句可以在作用域链的前端临时增加一个变量对象，该变量对象会在代码执行后被移除。
- try-catch语句的catch块
- with语句</p>

<pre><code class="language-js">function buildUrl() {
    var qs = &quot;?debug=true&quot;;

    with(location) {
        var url = href + qs; // location.href
    }

    return url;
}
</code></pre>

<h3 id="没有块级作用域">没有块级作用域</h3>

<p>JavaScript没有块级作用域。</p>

<ol>
<li><p>声明变量</p>

<p>使用var声明的变量会自动被添加到最接近的环境中。函数内部，最接近的环境就是函数的局部环境；在with语句中，最接近的环境是函数环境。如果初始化变量时没有使用var声明，该变量会自动被添加到全局环境。</p></li>

<li><p>查询标识符</p>

<p>在某个环境中为了读取或写入而引用一个标识符时，必须通过搜索来确定该标识符实际代表什么。搜索过程从作用域链的前端开始，向上逐级查询与给定名字匹配的标识符。</p>

<pre><code class="language-js">var color = &quot;blue&quot;

function getColor() {
    return color;
}

alert(getColor());   // &quot;blue&quot;
</code></pre></li>
</ol>

<h2 id="垃圾回收">垃圾回收</h2>

<p>JavaScript具有自动垃圾回收机制，也就是说，执行环境会负责管理代码执行过程中使用的内存。</p>

                </div>
                
            </article>
            <aside>
                <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#基本类型和引用类型的值">基本类型和引用类型的值</a>
<ul>
<li><a href="#动态的属性">动态的属性</a></li>
<li><a href="#复制变量值">复制变量值</a></li>
<li><a href="#传递参数">传递参数</a></li>
<li><a href="#检测类型">检测类型</a></li>
</ul></li>
<li><a href="#执行环境及作用域">执行环境及作用域</a>
<ul>
<li><a href="#延长作用域链">延长作用域链</a></li>
<li><a href="#没有块级作用域">没有块级作用域</a></li>
</ul></li>
<li><a href="#垃圾回收">垃圾回收</a></li>
</ul></li>
</ul>
</nav>
            </aside>
        </div>
    </div>

        <footer>
    Powered by <a target="_blank" href="https://gohugo.io/">Hugo</a>
</footer>
        <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
        


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.js"></script>

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script src="https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>
        <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <script type="text/javascript" src="/js/main.js"></script>
    </body>

</html>