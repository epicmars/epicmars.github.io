<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" >
        <meta lang="zh">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>React Native之Android开发：原生模块 | 风格与布局</title>
<meta name="description" content="如果React Native提供了调用操作系统所提供的所有功能的能力，那么就可以完全抛开原生代码，仅仅使用JavaScript就可以进行跨平台">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/solid.css" integrity="sha384-TbilV5Lbhlwdyc4RuIV/JhD8NR+BfMrvz4BL5QFa2we1hQu6wvREr3v6XSRfCTRp" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/brands.css" integrity="sha384-7xAnn7Zm3QC1jFjVc1A6v/toepoG3JXboQYzbM0jrPzou9OFXm/fY6Z/XiIebl/k" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/fontawesome.css" integrity="sha384-ozJwkrqb90Oa3ZNb+yKFW2lToAWYdTiF1vt8JiH5ptTGHTGcN7qdoR1F95e0kYyG" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
        
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen" href="/css/article.css" />

    </head>

    <body>
        <div class="site-wrapper">
                <header>
    <nav>
        <a class="home" href="https://www.androidpi.com/">首页</a>
    </nav>
    
</header>
                <div class="site-main">
                    
    <div class="main">
        <div class="article">
            <aside>
                    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#toast模块示例">Toast模块示例</a></li>
        <li><a href="#注册模块">注册模块</a></li>
        <li><a href="#callbacks">Callbacks</a></li>
        <li><a href="#promises">Promises</a></li>
        <li><a href="#线程threading">线程（Threading）</a></li>
        <li><a href="#发送事件给javascript">发送事件给JavaScript</a></li>
      </ul>
    </li>
    <li><a href="#在原生代码与react-native间进行通信httpfacebookgithubioreact-nativedocscommunication-ioshtml"><a href="http://facebook.github.io/react-native/docs/communication-ios.html">在原生代码与React Native间进行通信</a></a>
      <ul>
        <li><a href="#属性">属性</a></li>
      </ul>
    </li>
  </ul>
</nav>
            </aside>
            <article>
                <div class="title">
                    <h1 id="title">React Native之Android开发：原生模块</h1>
                </div>
                <div class="content">
                        <p>如果React Native提供了调用操作系统所提供的所有功能的能力，那么就可以完全抛开原生代码，仅仅使用JavaScript就可以进行跨平台App的开发了。然而现实而言，从市场的角度，苹果和Google两大巨头分别控制着IOS和Android两大平台的技术生态，基本不可能进行统一，从技术的角度看，操作系统的实现已经相当复杂，类似React Native这样的框架要提供接入系统绝大部分能力，那么所做的工作量还不如自己开发一个操作系统算了，因此，很多时候仍然需要部分原生代码的开发，以直接调用平台提供的API。</p>
<p>参考 <a href="http://facebook.github.io/react-native/docs/native-modules-android.html">原生模块（Native Modules）</a>。</p>
<p>有时一个App需要访问React Native还没有对应模块的平台API。也许你想复用一些Java代码，而不是在JavaScript中重新实现一遍。或者编写高性能的，高并发的代码，例如图像处理，数据库访问，或者任意数量的高级扩展。</p>
<h3 id="toast模块示例">Toast模块示例</h3>
<p>以Toast模块为例，如何从JavaScript中创建一个toast消息。</p>
<p>首先，需要创建一个原生模块。一个原生模块是一个通常继承<code>ReactContextBaseJavaModule</code>并实现JavaScript所需要功能的Java类。</p>
<ul>
<li>
<p><code>getName</code>方法返回的名称是在JavaScript中代表这个类的<code>NativeModule</code>名称</p>
</li>
<li>
<p><code>getConstants</code>方法返回暴露给JavaScript的常量值</p>
</li>
<li>
<p><code>@ReactMethod</code>注解用于暴露Java方法给JavaScript。</p>
<p>这些方法称为<strong>桥方法（bridge method）</strong>，桥方法总是返回<code>void</code>。React Native桥是异步的，因此将一个调用结果返回给JavaScript的唯一方式是使用<strong>回调（callbacks）<strong>或</strong>发表事件（emmitting events）</strong>。</p>
<p><code>@ReactMethod</code>注解的方法支持如下参数类型，其JavaScript等价类型如下所示：</p>
<pre><code>  Boolean -&gt; Bool
  Integer -&gt; Number
  Double -&gt; Number
  Float -&gt; Number
  String -&gt; String
  Callback -&gt; function
  ReadableMap -&gt; Object
  ReadableArray -&gt; Array
</code></pre>
</li>
</ul>
<h3 id="注册模块">注册模块</h3>
<p>最后一步是对模块进行注册。</p>
<p>为了更易于从JavaScript中访问原生模块，通常将原生模块包装在一个JavaScript模块中。这不是必须的，但省去了模块使用者每次从<code>NativeModules</code>中取出模块的操作。</p>
<h3 id="callbacks">Callbacks</h3>
<p>原生模块也支持一种特殊类型的参数值，即一个回调。在大多数情况下，它用于将函数调用结果提供给JavaScript。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> com.facebook.react.bridge.Callback<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UIManagerModule</span> <span style="color:#66d9ef">extends</span> ReactContextBaseJavaModule <span style="color:#f92672">{</span>

<span style="color:#f92672">...</span>

  <span style="color:#a6e22e">@ReactMethod</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">measureLayout</span><span style="color:#f92672">(</span>
      <span style="color:#66d9ef">int</span> tag<span style="color:#f92672">,</span>
      <span style="color:#66d9ef">int</span> ancestorTag<span style="color:#f92672">,</span>
      Callback errorCallback<span style="color:#f92672">,</span>
      Callback successCallback<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
      measureLayout<span style="color:#f92672">(</span>tag<span style="color:#f92672">,</span> ancestorTag<span style="color:#f92672">,</span> mMeasureBuffer<span style="color:#f92672">);</span>
      <span style="color:#66d9ef">float</span> relativeX <span style="color:#f92672">=</span> PixelUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">toDIPFromPixel</span><span style="color:#f92672">(</span>mMeasureBuffer<span style="color:#f92672">[</span>0<span style="color:#f92672">]);</span>
      <span style="color:#66d9ef">float</span> relativeY <span style="color:#f92672">=</span> PixelUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">toDIPFromPixel</span><span style="color:#f92672">(</span>mMeasureBuffer<span style="color:#f92672">[</span>1<span style="color:#f92672">]);</span>
      <span style="color:#66d9ef">float</span> width <span style="color:#f92672">=</span> PixelUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">toDIPFromPixel</span><span style="color:#f92672">(</span>mMeasureBuffer<span style="color:#f92672">[</span>2<span style="color:#f92672">]);</span>
      <span style="color:#66d9ef">float</span> height <span style="color:#f92672">=</span> PixelUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">toDIPFromPixel</span><span style="color:#f92672">(</span>mMeasureBuffer<span style="color:#f92672">[</span>3<span style="color:#f92672">]);</span>
      successCallback<span style="color:#f92672">.</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>relativeX<span style="color:#f92672">,</span> relativeY<span style="color:#f92672">,</span> width<span style="color:#f92672">,</span> height<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IllegalViewOperationException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      errorCallback<span style="color:#f92672">.</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>

<span style="color:#f92672">...</span>
</code></pre></div><p>上述方法在JavaScript中对应的调用如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">UIManager</span>.<span style="color:#a6e22e">measureLayout</span>(
  <span style="color:#ae81ff">100</span>,
  <span style="color:#ae81ff">100</span>,
  (<span style="color:#a6e22e">msg</span>) =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">msg</span>);
  },
  (<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>, <span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">height</span>) =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">width</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">height</span>);
  }
);
</code></pre></div><p>一个原生模块只执行回调一次，但是它可以保存回调函数并在以后进行调用。</p>
<p>需要注意的是JavaScript回调函数并不是在原生函数执行完成后就被立即调用。注意桥通信是异步的，它也是绑定到运行循环里的。</p>
<h3 id="promises">Promises</h3>
<p>原生模块也可以完成一个promise，它可以简化你的代码，尤其是你使用ES2016的<code>async/await</code>语法时。当桥接的原生方法的最后一个参数是一个<code>Promise</code>时，其对应的JS方法会返回一个JS Promise对象。</p>
<p>使用一个promise来重构上面的代码的：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> com.facebook.react.bridge.Promise<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UIManagerModule</span> <span style="color:#66d9ef">extends</span> ReactContextBaseJavaModule <span style="color:#f92672">{</span>

<span style="color:#f92672">...</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String E_LAYOUT_ERROR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;E_LAYOUT_ERROR&#34;</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">@ReactMethod</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">measureLayout</span><span style="color:#f92672">(</span>
      <span style="color:#66d9ef">int</span> tag<span style="color:#f92672">,</span>
      <span style="color:#66d9ef">int</span> ancestorTag<span style="color:#f92672">,</span>
      Promise promise<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
      measureLayout<span style="color:#f92672">(</span>tag<span style="color:#f92672">,</span> ancestorTag<span style="color:#f92672">,</span> mMeasureBuffer<span style="color:#f92672">);</span>

      WritableMap map <span style="color:#f92672">=</span> Arguments<span style="color:#f92672">.</span><span style="color:#a6e22e">createMap</span><span style="color:#f92672">();</span>

      map<span style="color:#f92672">.</span><span style="color:#a6e22e">putDouble</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;relativeX&#34;</span><span style="color:#f92672">,</span> PixelUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">toDIPFromPixel</span><span style="color:#f92672">(</span>mMeasureBuffer<span style="color:#f92672">[</span>0<span style="color:#f92672">]));</span>
      map<span style="color:#f92672">.</span><span style="color:#a6e22e">putDouble</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;relativeY&#34;</span><span style="color:#f92672">,</span> PixelUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">toDIPFromPixel</span><span style="color:#f92672">(</span>mMeasureBuffer<span style="color:#f92672">[</span>1<span style="color:#f92672">]));</span>
      map<span style="color:#f92672">.</span><span style="color:#a6e22e">putDouble</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;width&#34;</span><span style="color:#f92672">,</span> PixelUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">toDIPFromPixel</span><span style="color:#f92672">(</span>mMeasureBuffer<span style="color:#f92672">[</span>2<span style="color:#f92672">]));</span>
      map<span style="color:#f92672">.</span><span style="color:#a6e22e">putDouble</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;height&#34;</span><span style="color:#f92672">,</span> PixelUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">toDIPFromPixel</span><span style="color:#f92672">(</span>mMeasureBuffer<span style="color:#f92672">[</span>3<span style="color:#f92672">]));</span>

      promise<span style="color:#f92672">.</span><span style="color:#a6e22e">resolve</span><span style="color:#f92672">(</span>map<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IllegalViewOperationException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      promise<span style="color:#f92672">.</span><span style="color:#a6e22e">reject</span><span style="color:#f92672">(</span>E_LAYOUT_ERROR<span style="color:#f92672">,</span> e<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>

<span style="color:#f92672">...</span>
</code></pre></div><p>与该桥接方法配对的JavaScript调用返回一个Promise。这意味着你可以在一个async函数中使用<code>await</code>关键词来调用它并等待结果返回。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">measureLayout</span>() {
  <span style="color:#66d9ef">try</span> {
    <span style="color:#66d9ef">var</span> {<span style="color:#a6e22e">relativeX</span>, <span style="color:#a6e22e">relativeY</span>, <span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">height</span>} <span style="color:#f92672">=</span> <span style="color:#a6e22e">await</span> <span style="color:#a6e22e">UIManager</span>.<span style="color:#a6e22e">measureLayout</span>(
      <span style="color:#ae81ff">100</span>,
      <span style="color:#ae81ff">100</span>
    );

    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">relativeX</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">relativeY</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">width</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">height</span>);
  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">e</span>) {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">e</span>);
  }
}

<span style="color:#a6e22e">measureLayout</span>();
</code></pre></div><h3 id="线程threading">线程（Threading）</h3>
<p>原生模块不应当对其被调用时所在的线程进行任何假设，因为当前的线程分配在未来会发生变化。如果需要一个阻塞调用，这种重量级的工作应被分发给一个内部管理的工程线程，并且任意调用都从此处进行分发。</p>
<h3 id="发送事件给javascript">发送事件给JavaScript</h3>
<p>原生模块在没有被直接调用的情况下可以发送事件到JavaScript，最简单的方式是使用<code>RCTDeviceEventEmitter</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">...</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendEvent</span><span style="color:#f92672">(</span>ReactContext reactContext<span style="color:#f92672">,</span>
                       String eventName<span style="color:#f92672">,</span>
                       <span style="color:#a6e22e">@Nullable</span> WritableMap params<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  reactContext
      <span style="color:#f92672">.</span><span style="color:#a6e22e">getJSModule</span><span style="color:#f92672">(</span>DeviceEventManagerModule<span style="color:#f92672">.</span><span style="color:#a6e22e">RCTDeviceEventEmitter</span><span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
      <span style="color:#f92672">.</span><span style="color:#a6e22e">emit</span><span style="color:#f92672">(</span>eventName<span style="color:#f92672">,</span> params<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">...</span>
WritableMap params <span style="color:#f92672">=</span> Arguments<span style="color:#f92672">.</span><span style="color:#a6e22e">createMap</span><span style="color:#f92672">();</span>
<span style="color:#f92672">...</span>
sendEvent<span style="color:#f92672">(</span>reactContext<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;keyboardWillShow&#34;</span><span style="color:#f92672">,</span> params<span style="color:#f92672">);</span>
</code></pre></div><p>然后JavaScript模块可以使用<code>Subscribable mixin</code>通过<code>addListenerOn</code>进行注册来接收事件。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">DeviceEventEmitter</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react-native&#39;</span>;
...

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ScrollResponderMixin</span> <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">mixins</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">Subscribable</span>.<span style="color:#a6e22e">Mixin</span>],


  <span style="color:#a6e22e">componentWillMount</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>() {
    ...
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">addListenerOn</span>(<span style="color:#a6e22e">DeviceEventEmitter</span>,
                       <span style="color:#e6db74">&#39;keyboardWillShow&#39;</span>,
                       <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">scrollResponderKeyboardWillShow</span>);
    ...
  },
  <span style="color:#a6e22e">scrollResponderKeyboardWillShow</span><span style="color:#f92672">:</span><span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">e</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Event</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keyboardWillOpenTo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>;
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">onKeyboardWillShow</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">onKeyboardWillShow</span>(<span style="color:#a6e22e">e</span>);
  },
</code></pre></div><p>也可以直接使用<code>DeviceEventEmitter</code>来监听事件：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#a6e22e">componentWillMount</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>() {
  <span style="color:#a6e22e">DeviceEventEmitter</span>.<span style="color:#a6e22e">addListener</span>(<span style="color:#e6db74">&#39;keyboardWillShow&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">e</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Event</span>) {
    <span style="color:#75715e">// handle event.
</span><span style="color:#75715e"></span>  });
}
...
</code></pre></div><h2 id="在原生代码与react-native间进行通信httpfacebookgithubioreact-nativedocscommunication-ioshtml"><a href="http://facebook.github.io/react-native/docs/communication-ios.html">在原生代码与React Native间进行通信</a></h2>
<h3 id="属性">属性</h3>
<p>属性是跨组件通信的最简单方法。因此我们需要一种方法，可以将属性从原生组件传递给React Native，也可以从React Native传递给原生组件。</p>
<h4 id="将属性从原生组件传递到react-native">将属性从原生组件传递到React Native</h4>
<p>为了将一个React Native视图嵌入到一个原生组件中，我们使用了<code>RCTRootView</code>，它是一个支撑React Native App的<code>UIView</code>。它也提供了原生端和宿主App间的接口。</p>
<p><code>RCTRootView</code>有一个初始化器，允许将任意属性传递给React Native app。<code>initialProperties</code>参数必须是一个<code>NSDictionary</code>实例。在内部，字典被转换为顶级JS组件可以引用的一个JSON对象。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">NSArray</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">imageList</span> <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">@</span>[<span style="color:#960050;background-color:#1e0010">@</span><span style="color:#e6db74">&#34;http://foo.com/bar1.png&#34;</span>,
                       <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#e6db74">&#34;http://foo.com/bar2.png&#34;</span>];

<span style="color:#a6e22e">NSDictionary</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">props</span> <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">@</span>{<span style="color:#960050;background-color:#1e0010">@</span><span style="color:#e6db74">&#34;images&#34;</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">imageList</span>};

<span style="color:#a6e22e">RCTRootView</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">rootView</span> <span style="color:#f92672">=</span> [[<span style="color:#a6e22e">RCTRootView</span> <span style="color:#a6e22e">alloc</span>] <span style="color:#a6e22e">initWithBridge</span><span style="color:#f92672">:</span><span style="color:#a6e22e">bridge</span>
                                                 <span style="color:#a6e22e">moduleName</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#e6db74">&#34;ImageBrowserApp&#34;</span>
                                          <span style="color:#a6e22e">initialProperties</span><span style="color:#f92672">:</span><span style="color:#a6e22e">props</span>];
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">React</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
<span style="color:#66d9ef">import</span> {
  <span style="color:#a6e22e">AppRegistry</span>,
  <span style="color:#a6e22e">View</span>,
  <span style="color:#a6e22e">Image</span>
} <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react-native&#39;</span>;

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ImageBrowserApp</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">Component</span> {
  <span style="color:#a6e22e">renderImage</span>(<span style="color:#a6e22e">imgURI</span>) {
    <span style="color:#66d9ef">return</span> (
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Image</span> <span style="color:#a6e22e">source</span><span style="color:#f92672">=</span>{{<span style="color:#a6e22e">uri</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">imgURI</span>}} <span style="color:#f92672">/&gt;</span>
    );
  }
  <span style="color:#a6e22e">render</span>() {
    <span style="color:#66d9ef">return</span> (
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">View</span><span style="color:#f92672">&gt;</span>
        {<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">images</span>.<span style="color:#a6e22e">map</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">renderImage</span>)}
      <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/View&gt;</span>
    );
  }
}

<span style="color:#a6e22e">AppRegistry</span>.<span style="color:#a6e22e">registerComponent</span>(<span style="color:#e6db74">&#39;AwesomeProject&#39;</span>, () =&gt; <span style="color:#a6e22e">ImageBrowserApp</span>);
</code></pre></div><h4 id="将属性从react-native传递给原生组件">将属性从React Native传递给原生组件</h4>
<p>在<a href="http://facebook.github.io/react-native/docs/native-components-android.html">原生UI组件</a>中对将原生组件的属性暴露出来的问题进行了详细的说明。简而言之，在你的自定义原生组件中使用宏<code>RCT_CUSTOM_VIEW_PROPERTY</code>来暴露属性，然后就可以在React Native像使用普通React Native组件那样使用它们。</p>

                </div>
                
            </article>
        </div>
    </div>

                </div>
                <footer>
    Powered by <a target="_blank" href="https://gohugo.io/">Hugo</a> And 
    <a target="_blank" href="https://pages.github.com/">Github Pages</a>
</footer>
                <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
                

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.js"></script>

                <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.12.0/styles/default.min.css">
                <script src="/js/highlight.pack.js"></script>
                <script src="https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>
                <script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [
                ['$', '$'],
                ['\\(', '\\)']
            ],
            displayMath: [
                ['$$', '$$']
            ],
            processEscapes: true,
            processEnvironments: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            TeX: {
                equationNumbers: {
                    autoNumber: "AMS"
                },
                extensions: ["AMSmath.js", "AMSsymbols.js"]
            }
        }
    });
    MathJax.Hub.Queue(function () {



        var all = MathJax.Hub.getAllJax(),
            i;
        for (i = 0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });

    MathJax.Hub.Config({

        TeX: {
            equationNumbers: {
                autoNumber: "AMS"
            }
        }
    });
</script>
                <script type="text/javascript" src="/js/main.js"></script>
        </div>
    </body>

</html>